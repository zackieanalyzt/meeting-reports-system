# ЁЯзн р╕гр╕░р╕Ър╕Ъ 3-2-1 Backup (Debian + Docker + PostgreSQL + Google Drive)
**р╕зр╕▒р╕Щр╕Чр╕╡р╣И:** 1 р╕Юр╕др╕ир╕Ир╕┤р╕Бр╕▓р╕вр╕Щ 2025  
**р╕Ьр╕╣р╣Йр╕Ыр╕Пр╕┤р╕Ър╕▒р╕Хр╕┤:** р╕Юр╕╡р╣Ир╣Бр╕Лр╕Д @ Debian Trixie 64-bit  
**р╕Ьр╕╣р╣Йр╕Кр╣Ир╕зр╕в:** ChatGPT (GPT-5)

---

## тЬЕ р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Чр╕│р╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Гр╕Щр╕зр╕▒р╕Щр╕Щр╕╡р╣Й

### ЁЯФз р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕гр╕░р╕Ър╕Ър╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е (Backup System)
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х **Docker / Portainer Environment**
- р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕ер╕░р╕Чр╕Фр╕кр╕нр╕Ър╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣Мр╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕ер╕▒р╕Б 2 р╕Хр╕▒р╕з
    - `backup_superset.sh` тЖТ р╕кр╕│р╕гр╕нр╕Зр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е PostgreSQL р╕Вр╕нр╕З Apache Superset  
    - `backup_portainer.sh` тЖТ р╕кр╕│р╕гр╕нр╕З container, volume р╣Бр╕ер╕░ image р╕Чр╕▒р╣Йр╕Зр╕гр╕░р╕Ър╕Ъ Docker

### ЁЯТ╛ р╕гр╕░р╕Ър╕Ър╕кр╕│р╕гр╕нр╕Зр╣Бр╕Ър╕Ър╕лр╕ер╕▓р╕вр╕Кр╕▒р╣Йр╕Щ (Multi-Layer Backup)
| р╕Кр╕▒р╣Йр╕Щ | р╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣И | р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф |
|------|----------|-------------|
| 1я╕ПтГг | **Local Backup** | р╣Ар╕Бр╣Зр╕Ър╣Гр╕Щ `/var/backups/superset` р╣Бр╕ер╕░ `/backup_docker` (р╣Ар╕Бр╣Зр╕Ър╕вр╣Йр╕нр╕Щр╕лр╕ер╕▒р╕З 3 р╕зр╕▒р╕Щ) |
| 2я╕ПтГг | **Off-site (SFTP)** | р╕кр╣Ир╕Зр╕кр╕│р╣Ар╕Щр╕▓р╣Др╕Ыр╕вр╕▒р╕Зр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕З `192.168.100.170` р╕Ьр╣Ир╕▓р╕Щ SFTP р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ |
| 3я╕ПтГг | **Cloud (Google Drive)** | р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╣Др╕Ыр╕вр╕▒р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М `3-2-1 Backup` р╕Ър╕Щ Drive р╣Вр╕Фр╕вр╣Гр╕Кр╣Й `rclone` |

### тШБя╕П р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н Google Drive р╕кр╕│р╣Ар╕гр╣Зр╕Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М
- remote: `gdrive_offsite`
- manual authorize (р╣Ар╕Юр╕гр╕▓р╕░р╣Др╕бр╣Ир╕бр╕╡ GUI)
- р╕Чр╕Фр╕кр╕нр╕Ър╕Фр╣Йр╕зр╕в `rclone lsd gdrive_offsite:`
- Upload path:
    - `3-2-1 Backup/superset`
    - `3-2-1 Backup/docker`

### ЁЯУж р╕Бр╕▓р╕гр╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╕Вр╕╢р╣Йр╕Щ Google Drive
**Superset Backup**
- р╕Вр╕Щр╕▓р╕Фр╕гр╕зр╕б ~3.4 GB
- р╣Гр╕Кр╣Йр╣Ар╕зр╕ер╕▓ ~12 р╕Щр╕▓р╕Чр╕╡
- тЬЕ Uploaded тЖТ `3-2-1 Backup/superset`

**Docker + Portainer Backup**
- р╕Вр╕Щр╕▓р╕Фр╕гр╕зр╕б ~7.5 GB
- р╣Гр╕Кр╣Йр╣Ар╕зр╕ер╕▓ ~19 р╕Щр╕▓р╕Чр╕╡
- тЬЕ Uploaded тЖТ `3-2-1 Backup/docker`

### ЁЯзо р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╣Бр╕ер╕░р╕Бр╕▓р╕гр╕зр╕▓р╕Зр╣Бр╕Ьр╕Щ
- Local retention: 3 р╕зр╕▒р╕Щ (`find ... -mtime +3 -delete`)
- Cloud retention: `rclone copy` (р╣Др╕бр╣Ир╕ер╕Ър╣Ар╕Бр╣Ир╕▓р╕Ър╕Щ Drive)
- р╕Цр╣Йр╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╣Йр╕▓р╕З Drive р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤:
```bash
rclone delete gdrive_offsite:"3-2-1 Backup/docker" --min-age 7d
```

### ЁЯХР р╣Бр╕Ьр╕Щр╕Бр╕▓р╕гр╕гр╕▒р╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (Cron)
```bash
0 2 * * * /usr/local/sbin/backup_superset.sh
20 2 * * * /usr/local/sbin/backup_portainer.sh
```

---

## ЁЯОп р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в
- р╕гр╕░р╕Ър╕Ър╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ър╕зр╕Зр╕Ир╕г 3-2-1 (Local + Off-site + Cloud)
- р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Ьр╣Ир╕▓р╕Щ cron
- р╕кр╕│р╣Ар╕Щр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕вр╕╣р╣Ир╣Гр╕Щ 3 р╕Ир╕╕р╕Ф р╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕вр╕Ир╕▓р╕Бр╕Др╕зр╕▓р╕бр╣Ар╕кр╕╡р╕вр╕лр╕▓р╕вр╕Чр╕╕р╕Бр╕гр╕░р╕Фр╕▒р╕Ъ
- р╕бр╕╡ log р╣Бр╕ер╕░ checksum р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ

> ЁЯзШтАНтЩВя╕П **р╕кр╕гр╕╕р╕Ыр╕кр╕▒р╣Йр╕Щ р╣Ж:**  
> р╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ър╕кр╕│р╕гр╕нр╕Зр╕Чр╕╡р╣Ир╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕ар╕▓р╕вр╕Щр╕нр╕Б тАФ р╕зр╕▒р╕Щр╕Щр╕╡р╣Йр╕Юр╕╡р╣Ир╣Бр╕Лр╕Др╕бр╕╡ full 3-2-1 backup ecosystem р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕Зр╕Чр╕▒р╣Йр╕Зр╕Ър╕Щ server р╣Бр╕ер╕░ cloud  
> р╕гр╕░р╕Ър╕Ър╕Щр╕╡р╣Йр╣Ар╕гр╕╡р╕вр╕Бр╣Др╕Фр╣Йр╕зр╣Ир╕▓ тАЬself-healing & disaster-resilientтАЭ р╣Бр╕ер╣Йр╕зр╕Др╕гр╕▒р╕Ъ ЁЯТк

---
**р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Щр╕╡р╣Йр╕Ир╕▒р╕Фр╕Чр╕│р╣Ар╕бр╕╖р╣Ир╕н:** Sat, 1 Nov 2025 тАУ 21:00 (GMT+7)
